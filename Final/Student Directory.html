<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Directory</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f7f6; margin: 20px; }
        .container { max-width: 1000px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #333; }
        form, .filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; align-items: center; }
        input, select, button { padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
        input:read-only { background-color: #e9ecef; cursor: not-allowed; }
        button { background-color: #007bff; color: white; cursor: pointer; border: none; }
        button:hover { background-color: #0056b3; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #f2f2f2; }
        .edit-btn, .delete-btn { padding: 5px 10px; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px; }
        .edit-btn { background-color: #ffc107; }
        .delete-btn { background-color: #dc3545; }
    </style>
</head>
<body>

<div class="container">

<nav style="background:#0d6efd; padding:12px; border-radius:8px; margin-bottom:20px; display:flex; gap:15px; flex-wrap:wrap;">
  <a href="Student Directory.html" style="color:white; text-decoration:none; font-weight:bold;">🏫 Student Directory</a>]
  <a href="Subject manager.html" style="color:white; text-decoration:none;">📚 Subject Manager</a>
  <a href="Syllabus_progress.html" style="color:white; text-decoration:none;">📊 Syllabus Progress</a>
  <a href="workpool.html" style="color:white; text-decoration:none;">📝 Work Pool</a>
  <a href="Dought Task.html" style="color:white; text-decoration:none;">❓ Doubt Box</a>
  <a href="Test Treacker.html" style="color:white; text-decoration:none;">📘 Test Tracker</a>
  <a href="Attendence.html" style="color:white; text-decoration:none;">📅 Attendance</a>
</nav>

    <h2>Student Directory</h2>
    
    <form id="student-form">
        <input type="hidden" id="student-id">
        <input type="text" id="studentID" placeholder="Student ID (auto)" readonly>
        <input type="text" id="name" placeholder="Name" required>
        <input type="text" id="grade" placeholder="Grade" required>
        <input type="text" id="board" placeholder="Board" required>
        <input type="text" id="school" placeholder="School" required>
        <input type="text" id="batch" placeholder="Batch" required>
        <input type="text" id="time-slot" placeholder="Time Slot" required>
        <button type="submit">Save Student</button>
    </form>

    <div class="filters">
        <input type="text" id="search-name" placeholder="Search by Name...">
        <select id="filter-grade">
            <option value="">Filter by Grade</option>
        </select>
        <button onclick="applyFilters()">Search / Filter</button>
    </div>

    <table id="student-table">
        <thead>
            <tr>
                <th>Student ID</th>
                <th>Name</th>
                <th>Grade</th>
                <th>Board</th>
                <th>School</th>
                <th>Batch</th>
                <th>Time Slot</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="student-list">
            </tbody>
    </table>
</div>

<script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore-compat.js"></script>

 

<script>
    // --- PASTE YOUR FIREBASE CONFIGURATION OBJECT HERE ---
    const firebaseConfig = {
        apiKey: "AIzaSyBOhbm4Hgg0fhcomZfp-BpC6jfeAsshuF8",
        authDomain: "edudashboard-65a9f.firebaseapp.com",
        projectId: "edudashboard-65a9f",
        storageBucket: "edudashboard-65a9f.firebasestorage.app",
        messagingSenderId: "1007330679468",
        appId: "1:1007330679468:web:97cff4a762e9fd9df51d09"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const studentsCollection = db.collection("students");

    const studentForm = document.getElementById('student-form');
    const studentList = document.getElementById('student-list');
    const studentIdField = document.getElementById('student-id');
    const gradeFilter = document.getElementById('filter-grade');

    // CREATE & UPDATE
    studentForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = studentIdField.value;
        const studentData = {
            name: document.getElementById('name').value,
            grade: document.getElementById('grade').value,
            board: document.getElementById('board').value,
            school: document.getElementById('school').value,
            batch: document.getElementById('batch').value,
            timeSlot: document.getElementById('time-slot').value,
        };

        try {
            if (id) {
                // Update existing student
                await studentsCollection.doc(id).update(studentData);
                console.log("Student updated successfully!");
            } else {
                // Add new student
                studentData.studentID = `SID${Date.now()}`;
                await studentsCollection.add(studentData);
                console.log("Student added successfully!");
            }
            studentForm.reset();
            studentIdField.value = '';
            fetchStudents();
        } catch (error) {
            console.error("Error saving student: ", error);
        }
    });

    // READ & RENDER
    const fetchStudents = async () => {
        try {
            const snapshot = await studentsCollection.orderBy("name").get();
            renderStudents(snapshot);
            populateGradeFilter(snapshot);
        } catch (error) {
            console.error("Error fetching students: ", error);
        }
    };

    const renderStudents = (snapshot) => {
        studentList.innerHTML = '';
        snapshot.forEach(doc => {
            const student = doc.data();
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${student.studentID || 'N/A'}</td>
                <td>${student.name}</td>
                <td>${student.grade}</td>
                <td>${student.board}</td>
                <td>${student.school}</td>
                <td>${student.batch}</td>
                <td>${student.timeSlot}</td>
                <td>
                    <button class="edit-btn" onclick="editStudent('${doc.id}')">Edit</button>
                    <button class="delete-btn" onclick="deleteStudent('${doc.id}')">Delete</button>
                </td>
            `;
            studentList.appendChild(row);
        });
    };

    // Populate grade filter dropdown
    const populateGradeFilter = (snapshot) => {
        const grades = new Set();
        snapshot.forEach(doc => grades.add(doc.data().grade));
        gradeFilter.innerHTML = '<option value="">Filter by Grade</option>';
        grades.forEach(grade => {
            const option = document.createElement('option');
            option.value = grade;
            option.textContent = grade;
            gradeFilter.appendChild(option);
        });
    };

    // EDIT
    window.editStudent = async (id) => {
        try {
            const doc = await studentsCollection.doc(id).get();
            if (doc.exists) {
                const student = doc.data();
                studentIdField.value = id;
                document.getElementById('studentID').value = student.studentID || '';
                document.getElementById('name').value = student.name;
                document.getElementById('grade').value = student.grade;
                document.getElementById('board').value = student.board;
                document.getElementById('school').value = student.school;
                document.getElementById('batch').value = student.batch;
                document.getElementById('time-slot').value = student.timeSlot;
                window.scrollTo(0, 0); // Scroll to top to see the form
            }
        } catch (error) {
            console.error("Error fetching student for edit: ", error);
        }
    };

    // DELETE
    window.deleteStudent = async (id) => {
        if (confirm("Are you sure you want to delete this student?")) {
            try {
                await studentsCollection.doc(id).delete();
                console.log("Student deleted successfully!");
                fetchStudents();
            } catch (error) {
                console.error("Error deleting student: ", error);
            }
        }
    };

    // SEARCH & FILTER
    window.applyFilters = async () => {
        const searchName = document.getElementById('search-name').value.toLowerCase();
        const selectedGrade = gradeFilter.value;

        try {
            let query = studentsCollection;
            
            // Note: Firestore does not support case-insensitive search directly or combining filters on different fields without composite indexes.
            // This is a client-side filter for simplicity. For large datasets, use a dedicated search service like Algolia.
            
            const snapshot = await query.orderBy("name").get();
            const filteredDocs = snapshot.docs.filter(doc => {
                const student = doc.data();
                const nameMatch = student.name.toLowerCase().includes(searchName);
                const gradeMatch = selectedGrade ? student.grade === selectedGrade : true;
                return nameMatch && gradeMatch;
            });

            // Re-render with filtered data
            studentList.innerHTML = '';
             filteredDocs.forEach(doc => {
                const student = doc.data();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.studentID || 'N/A'}</td>
                    <td>${student.name}</td>
                    <td>${student.grade}</td>
                    <td>${student.board}</td>
                    <td>${student.school}</td>
                    <td>${student.batch}</td>
                    <td>${student.timeSlot}</td>
                    <td>
                        <button class="edit-btn" onclick="editStudent('${doc.id}')">Edit</button>
                        <button class="delete-btn" onclick="deleteStudent('${doc.id}')">Delete</button>
                    </td>
                `;
                studentList.appendChild(row);
            });

        } catch (error) {
            console.error("Error applying filters: ", error);
        }
    };

    // Initial fetch
    fetchStudents();
</script>

</body>
</html>